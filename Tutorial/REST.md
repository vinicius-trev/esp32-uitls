# REST

1. Used to get things from the internet. In other words, make HTTP requests
2. To perform requests, configure the `esp_http_client_config_t`. There are some things that must be set:
    - url
    - method (POST, GET, PUT, DELETE)
    - event_handler (callback to manipulate the request data)
    - user_data (optional do specify an struct as payload buffer)
3. There are a util VSCode extensions to test requests: Thunder Client
4. Create the client handler with `esp_http_client_init(<config_struct>)`
5. Fill the client request header with `esp_http_client_set_header()`
6. Perform the request with `esp_http_client_perform()`
7. The request can be blocked or not. If not blocking a code will be returning indicating if the request finished or not at each call to the function
8. It is useful to get the return status code and content lenght with:
    - `esp_http_client_get_status_code()`
    - `esp_http_client_get_content_lenght()`
9. Cleanup the resources with `esp_http_cleanup(<client_handler>)`
10. In the callback that will receive the request data, there are a lot of event that can be generated. They are in the `esp_http_client_event_id_t` struct
11. Use `realloc()` to init and extend the payload buffer
12. Useful site to generate APIs: [RapidAPI](https://rapidapi.com)
13. When using HTTPS:
    - While testing the requests, disable certificate validation in kconfig (only for development stuff)
    - Copy the url cert and embedd it in the code:
      - Copy the certificate in BASE64 to the project
      - Edit the CMakeLists to include the new text file (`EMBED_TXTFILES "<path_to_the_file>"`), as described in [STORAGE.md](./STORAGE.md)
      - Edit the `cert_pem` parameter in the client config handler, including the certificate
    - There is also an option to use the embedTLS certificate bundle to perform operations where the cert is generated by a well known entity
      - Cauting that this option uses a LOT OF DYNAMIC MEMORY while performing the HTTPS request
14. To parse JSON content in the IDF use the `cjson.h` library
    - While parsing JSON, the dram will probably be consumed a lot (depending on the size of the payload): String Payload + JSON object = 2x +++ the size of the payload
    - Option 1: Decrease the JSON size and parse it by chunks (example: saving a buffer to flash or doing chunk by chunk)
    - Option 2: Use PSRAM
    - CJSON can use hooks to allocate its content to the PSRAM
15. Emails can be send using external APIs like the [sendgrid.com](https://sendgrid.com)
16. The topics of this page reflect the same steps for any communication request (MQTT for example)
